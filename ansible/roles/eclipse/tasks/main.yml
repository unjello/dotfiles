---
- name: Inlcude OS-specific variables
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_major_version | int}}.yml"
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"
    - "default.yml"

- name: Check if eclipse is installed
  stat:
    path: /opt/eclipse/eclipse
  register: eclipse_stat_result

- name: Download and install Eclipse package
  become: true
  unarchive:
    src: "{{ package_url }}"
    dest: /opt
    remote_src: true
  when: eclipse_stat_result.stat.exists is sameas False

- name: Fix Eclipse folder ownership
  become: true
  file:
    path: /opt/eclipse
    owner: "{{ ansible_user_id }}"
    recurse: yes
  when: eclipse_stat_result.stat.exists is sameas False

- name: Create symlink to Eclipse
  become: true
  file:
    src: /opt/eclipse/eclipse
    dest: /usr/local/bin/eclipse
    state: link
  when: eclipse_stat_result.stat.exists is sameas False

- name: Create Eclipse desktop launcher
  become: true
  copy:
    src: "{{ role_path }}/files/eclipse.desktop"
    dest: /usr/share/applications/eclipse.desktop
  when: eclipse_stat_result.stat.exists is sameas False

- name: Check if eclim is installed
  stat:
    path: /opt/eclipse/eclimd
  register: eclimd_stat_result

- name: Download eclim
  get_url:
    url: https://github.com/ervandew/eclim/releases/download/2.8.0/eclim_2.8.0.bin
    dest: /tmp/eclim.bin
  when: eclimd_stat_result.stat.exists is sameas False

- name: Install eclim
  command: sh /tmp/eclim.bin --eclipse=/opt/eclipse --plugins=jdt --vimfiles=skip --yes
  args:
    creates: /opt/eclipse/eclimd
  when: eclimd_stat_result.stat.exists is sameas False

- name: Remove eclip installation file
  file:
    name: /tmp/eclim.bin
    state: absent